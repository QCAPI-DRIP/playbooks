
#- debug:
#    var: item
#  with_items:
#    - "{{state}}"
#    - "{{name}}"
#    - "{{image}}"
#    - "{{key_name}}"
#    - "{{flavor}}"
#    - "{{network}}"
#    - "{{auth_url}}"
##    - "{{access_token}}"
##    - "{{identity_provider}}"
##    - "{{protocol}}"

- os_server:
    state: "{{ state }}"
    name: "{{ name }}"
    image: "{{ image }}"
    key_name: "{{ key_name }}"
    flavor: "{{ flavor }}"
    network: "{{ network }}"
  environment:
    OS_AUTH_URL: "{{ auth_url }}"
    OS_ACCESS_TOKEN: "{{ access_token }}"
    OS_PROJECT_ID: "{{ project_id }}"
    OS_AUTH_TYPE: v3oidcaccesstoken
    OS_IDENTITY_PROVIDER: "{{ identity_provider }}"
    OS_PROTOCOL: "{{ protocol }}"
  register: os_server_output