- hosts: localhost
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: install openstacksdk
      pip:
        name: openstacksdk

#    - name: Echo my_env_var again
#      shell: "echo $OS_AUTH_URL $OS_PROJECT_ID $OS_AUTH_TYPE $OS_IDENTITY_PROVIDER $OS_PROTOCOL $OS_ACCESS_TOKEN"
#      register: ps
#
#    - debug: var=ps.stdout_lines
#
#
#    - name: get vm flavors
#      os_flavor_info:
#      register: result
#
#    - name: print result
#      debug:
#        var: result
#
#    - name: Retrieve all available images
#      os_image_info:
#      register: result
#
#    - name: Show images
#      debug:
#        msg: "{{ result.openstack_image }}"

    - name: launch an instance
      os_server:
        state: present
        name: vm1
        availability_zone: nova
        image: b0049ae9-3090-4a76-b9da-c985409b3228
        key_name: deleteme
        timeout: 200
        flavor: 2d4b92be-3f73-4308-a930-2acc426e4998
        security_groups:
          - ssl
          - http
          - 8008